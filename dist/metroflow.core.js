var MetroFlow=MetroFlow||{};MetroFlow.core=function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e){t.exports=paper},function(t,e,i){function n(t){return Object.create(a).Station(t)}function r(){return Object.create(l)}function o(t,e){return Object.create(c).Segment(t,e)}i(0);var s={strokeColor:"black",strokeWidth:4,fillColor:"white",stationRadius:8,selectionColor:"green",fullySelected:!0},a={Station:function(t){return console.log("new station for point",t),this.position=t,this},isSelected:!1,toggleSelect:function(){this.isSelected?this.unselect():this.select()},select:function(){this.isSelected=!0,this.circle.strokeColor=s.selectionColor},unselect:function(){this.isSelected=!1,this.circle.strokeColor=s.strokeColor},draw:function(){this.circle=new Path.Circle(this.position,s.stationRadius),this.circle.strokeColor=s.strokeColor,this.circle.strokeWidth=s.strokeWidth,this.circle.fillColor=s.fillColor,this.circle.fullySelected=s.isDebug}},l={stations:[],segments:[],draw:function(){console.log("draw track"),this.createSegments(),project.clear();for(var t in this.segments){var e=null;t>0&&(e=this.segments[t-1]),this.segments[t].draw(e)}for(var t in this.stations)this.stations[t].draw()},createSegments:function(){this.segments=[];for(var t=1;t<this.stations.length;++t){var e=this.stations[t-1],i=this.stations[t],n=o(e.position,i.position);this.segments.push(n)}},findStation:function(t){for(var e in this.stations){var i=this.stations[e].circle.id;if(console.log(i),this.stations[e].circle.id===t)return this.stations[e]}return null}},c={Segment:function(t,e){return this.begin=t,this.end=e,this},direction:function(){return this.end-this.begin},createPath:function(){var t=new Path;return t.strokeColor="red",t.strokeWidth=8,t.strokeCap="round",t.strokeJoin="round",t.fullySelected=!0,t},draw:function(t){var e=this.end-this.begin,i=Math.min(Math.abs(e.x),Math.abs(e.y))-40,n=Math.abs(e.y)-i,r=Math.abs(e.x)-i;n=Math.max(n,40),r=Math.max(r,40);var o=new Point(0,n)*Math.sign(e.y),s=new Point(r,0)*Math.sign(e.x);if(t&&Math.abs(t.direction().x)>Math.abs(t.direction().y)&&(o=new Point(r,0)*Math.sign(e.x),s=new Point(0,n)*Math.sign(e.y)),Math.abs(e.x)>60&&Math.abs(e.y)>60){var a=this.end-s,l=this.begin+o,c=l-10*o.normalize()*2,h=l-10*o.normalize(),d=l+10*(a-l).normalize(),u=l+10*(a-l).normalize()*2,f=h+(d-h)/2,g=f+(l-f)/1.7,m=this.createPath();m.add(this.begin),m.add(c);var b=a-10*(a-l).normalize()*2,v=a-10*(a-l).normalize(),p=a+10*s.normalize(),w=a+10*s.normalize()*2,C=p+(v-p)/2,k=C+(a-C)/1.7,M=this.createPath();M.add(c),M.add(h),M.add(g),M.add(d),M.add(u),M.smooth();var S=this.createPath();S.add(u),S.add(b);var P=this.createPath();P.add(b),P.add(v),P.add(k),P.add(p),P.add(w),P.smooth();var y=this.createPath();y.add(a+10*s.normalize()*2),y.add(this.end)}else{var x=this.createPath();x.add(this.begin),x.add(this.end),x.smooth()}var z=e/2+this.begin,j=new Path.Circle(z,4);j.strokeWidth=1,j.strokeColor="blue",j.fillColor="blue";var O=new Path.Circle(l,4);O.style=j.style,O.strokeColor="green",O.fillColor="green",new Path.Circle(a,4).style=O.style}};t.exports={StationStyle:s,createStation:n,createSegment:o,createTrack:r}}]);