var MetroFlow=MetroFlow||{};MetroFlow.sketcher=function(t){function e(n){if(o[n])return o[n].exports;var i=o[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var o={};return e.m=t,e.c=o,e.d=function(t,o,n){e.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=2)}([function(t,e){t.exports=paper},function(t,e,o){function n(t){return Object.create(a).Station(t)}function i(){return Object.create(l)}function s(t,e){return Object.create(c).Segment(t,e)}o(0);var r={strokeColor:"black",strokeWidth:4,fillColor:"white",stationRadius:8,selectionColor:"green",fullySelected:!0},a={Station:function(t){return console.log("new station for point",t),this.position=t,this},isSelected:!1,toggleSelect:function(){this.isSelected?this.unselect():this.select()},select:function(){this.isSelected=!0,this.circle.strokeColor=r.selectionColor},unselect:function(){this.isSelected=!1,this.circle.strokeColor=r.strokeColor},draw:function(){this.circle=new Path.Circle(this.position,r.stationRadius),this.circle.strokeColor=r.strokeColor,this.circle.strokeWidth=r.strokeWidth,this.circle.fillColor=r.fillColor,this.circle.fullySelected=r.isDebug}},l={stations:[],segments:[],draw:function(){console.log("draw track"),this.createSegments(),project.clear();for(var t in this.segments){var e=null;t>0&&(e=this.segments[t-1]),this.segments[t].draw(e)}for(var t in this.stations)this.stations[t].draw()},createSegments:function(){this.segments=[];for(var t=1;t<this.stations.length;++t){var e=this.stations[t-1],o=this.stations[t],n=s(e.position,o.position);this.segments.push(n)}},findStation:function(t){for(var e in this.stations){var o=this.stations[e].circle.id;if(console.log(o),this.stations[e].circle.id===t)return this.stations[e]}return null}},c={Segment:function(t,e){return this.begin=t,this.end=e,this},direction:function(){return this.end-this.begin},createPath:function(){var t=new Path;return t.strokeColor="red",t.strokeWidth=8,t.strokeCap="round",t.strokeJoin="round",t.fullySelected=!0,t},draw:function(t){var e=this.end-this.begin,o=Math.min(Math.abs(e.x),Math.abs(e.y))-40,n=Math.abs(e.y)-o,i=Math.abs(e.x)-o;n=Math.max(n,40),i=Math.max(i,40);var s=new Point(0,n)*Math.sign(e.y),r=new Point(i,0)*Math.sign(e.x);if(t&&Math.abs(t.direction().x)>Math.abs(t.direction().y)&&(s=new Point(i,0)*Math.sign(e.x),r=new Point(0,n)*Math.sign(e.y)),Math.abs(e.x)>60&&Math.abs(e.y)>60){var a=this.end-r,l=this.begin+s,c=l-10*s.normalize()*2,h=l-10*s.normalize(),d=l+10*(a-l).normalize(),u=l+10*(a-l).normalize()*2,g=h+(d-h)/2,f=g+(l-g)/1.7,m=this.createPath();m.add(this.begin),m.add(c);var p=a-10*(a-l).normalize()*2,v=a-10*(a-l).normalize(),b=a+10*r.normalize(),w=a+10*r.normalize()*2,M=b+(v-b)/2,y=M+(a-M)/1.7,k=this.createPath();k.add(c),k.add(h),k.add(f),k.add(d),k.add(u),k.smooth();var S=this.createPath();S.add(u),S.add(p);var C=this.createPath();C.add(p),C.add(v),C.add(y),C.add(b),C.add(w),C.smooth();var x=this.createPath();x.add(a+10*r.normalize()*2),x.add(this.end)}else{var P=this.createPath();P.add(this.begin),P.add(this.end),P.smooth()}var z=e/2+this.begin,j=new Path.Circle(z,4);j.strokeWidth=1,j.strokeColor="blue",j.fillColor="blue";var O=new Path.Circle(l,4);O.style=j.style,O.strokeColor="green",O.fillColor="green",new Path.Circle(a,4).style=O.style}};t.exports={StationStyle:r,createStation:n,createSegment:s,createTrack:i}},function(t,e,o){function n(t){var e=project.hitTest(t.point,l);if(e)return console.log("hitresults"),h=e.item,console.log(h.id),c=r.findStation(h.id),console.log("station",c),c&&c.toggleSelect(),void("segment"==e.type&&(console.log("segment"),segment=e.segment));console.log("onMouseDown");var o=new Point(t.point.x,t.point.y);if(r.stations.length>0){var n=r.stations[r.stations.length-1];Math.abs(n.position.x-o.x)<a&&(o.x=n.position.x),Math.abs(n.position.y-o.y)<a&&(o.y=n.position.y)}var i=s.createStation(o);r.stations.push(i),r.draw()}function i(t){console.log("mouseDrag"),console.log("station",c),c&&(c.position+=t.delta,r.draw())}o(0);var s=o(1),r=s.createTrack(),a=60,l={segments:!0,stroke:!0,fill:!0,tolerance:5},c=null,h=null;tool.onMouseDown=n,tool.onMouseDrag=i}]);